// Generated by CoffeeScript 1.3.3
(function() {

  $(function() {
    return $('#search-form').submit(function(e) {
      var searchWord,
        _this = this;
      e.preventDefault();
      searchWord = $('#input').val();
      $.ajax({
        data: {
          "word": searchWord
        },
        type: 'POST',
        url: "/search/",
        beforeSend: function(jqXHR, settings) {
          $('#results').slideUp();
          return $('#message').html('<span class="alert center alert-info">查询中……</span>').fadeIn();
        },
        success: function(data, textStatus, jqXHR) {
          var zipLink;
          $('#message').fadeOut();
          $('#result-list').empty();
          $.each(data[0].ImgList, function(index, value) {
            var fileName, href, link, linkText;
            linkText = "穷游" + searchWord + "攻略" + index;
            fileName = linkText + value.split('.').pop();
            link = $("<a>" + linkText + "</a>");
            href = ("" + value) + ("#name=" + linkText) + '&content-type=image/jpeg' + '&filepath=/sdcard/travel/';
            link.attr('href', href);
            link.attr('download', fileName);
            link.attr('id', index);
            link.attr('name', value);
            return $('#result-list').append(link);
          });
          zipLink = $("<a>旅人" + searchWord + "攻略</a>");
          zipLink.attr('href', data[1].PdfLink);
          $('#result-list').append(zipLink);
          $('#result-list a').wrap('<li></li>');
          return $('#results').slideDown();
        },
        error: function(jqXHR, textStatus, errorThrown) {
          return $('#message').html('<span class="alert center alert-info">查询失败</span>');
        }
      });
      return false;
    });
  });

}).call(this);
