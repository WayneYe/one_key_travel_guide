// Generated by CoffeeScript 1.3.3
(function() {

  $(function() {
    $('#downloadAll').click(function() {
      console.log("downloadAll!");
      return $('#result-list a').each(function() {
        return $(this).click();
      });
    });
    return $('#search-form').submit(function(e) {
      var searchWord,
        _this = this;
      e.preventDefault();
      searchWord = $('#input').val();
      $.ajax({
        data: {
          "word": searchWord
        },
        type: 'POST',
        url: "/search/",
        beforeSend: function(jqXHR, settings) {
          $('#results').slideUp();
          return $('#message').html('<span class="alert center alert-info">查询中……</span>').fadeIn();
        },
        success: function(data, textStatus, jqXHR) {
          var synthesizeLink;
          $('#message').fadeOut();
          $('#result-list').empty();
          synthesizeLink = function(url, index) {
            var fileName, href, link, linkText;
            linkText = "" + searchWord + "攻略" + index;
            fileName = linkText + url.split('.').pop();
            href = ("" + url) + ("#name=" + linkText) + '&content-type=image/jpeg' + '&filepath=/sdcard/travel/';
            link = $("<a>" + linkText + "</a>");
            link.attr('href', href);
            link.attr('download', fileName);
            link.attr('name', url);
            return link;
          };
          _.each(data, function(source, sourceIndex, sourcelist) {
            _.each(source.ImgList, function(element, index, list) {
              $('#result-list').append(synthesizeLink(element, index));
              return _this;
            });
            return _.each(source.PdfLink, function(element, index, list) {
              $('#result-list').append(synthesizeLink(element, index));
              return _this;
            });
          });
          $('#result-list a').wrap('<li></li>');
          return $('#results').slideDown();
        },
        error: function(jqXHR, textStatus, errorThrown) {
          return $('#message').html('<span class="alert center alert-info">查询失败</span>');
        }
      });
      return false;
    });
  });

}).call(this);
